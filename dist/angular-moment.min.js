//!  Angular Moment.js v0.3.0
//!  https://github.com/shaungrady/angular-momentjs
//!  (c) 2014 Shaun Grady
//!  License: MIT
"use strict";angular.module("moment",[]),angular.module("moment").constant("indexOf",function(t,e){if(t.indexOf)return t.indexOf(e);for(var n=0;n<t.length;n++)if(e===t[n])return n;return-1}).constant("getOffset",function(t){if(t){var e,n,a,o,i,r,m,l,d,u,s,f=document,c=window,p=f.body,$=f.documentElement,h=f.createElement("div");return h.style.paddingLeft=h.style.width="1px",p.appendChild(h),e=2==h.offsetWidth,p.removeChild(h),h=t.getBoundingClientRect(),n=$.clientTop||p.clientTop||0,a=$.clientLeft||p.clientLeft||0,o=c.pageYOffset||e&&$.scrollTop||p.scrollTop,i=c.pageXOffset||e&&$.scrollLeft||p.scrollLeft,u=o-n,s=i-a,r=h.top+u,d=h.left+s,l=h.bottom+u,m=h.right+s,{top:r,left:d,bottom:l,right:m}}}),angular.module("moment").provider("$moment",function(){function t(t){return t=t||"",t.match(/l/i)?moment().lang()._longDateFormat[t]||t:t}var e={$$pickerTemplates:{},$strictView:!0,$strictModel:!0,$defaultViewFormat:"L",$defaultModelFormat:moment.defaultFormat,$parseFormat:t};this.defaultViewFormat=function(t){return angular.isString(t)&&(e.$defaultViewFormat=t),this},this.defaultModelFormat=function(t){return angular.isString(t)&&(e.$defaultModelFormat=t),this},this.strictView=function(t){return"boolean"==typeof t&&(e.$strictView=t),this},this.strictModel=function(t){return"boolean"==typeof t&&(e.$strictModel=t),this},this.definePickerTemplate=function(t){return angular.isObject(t)&&t.name&&t.url&&(e.$$pickerTemplates[t.name]={url:t.url,unit:t.unit||"days"}),this},this.$get=function(){if(angular.isDefined(moment.$strictView))return moment;try{Object.defineProperty(moment,"$strictView",{value:e.$strictView}),Object.defineProperty(moment,"$strictModel",{value:e.$strictModel}),Object.defineProperty(moment,"$defaultViewFormat",{value:e.$defaultViewFormat}),Object.defineProperty(moment,"$defaultModelFormat",{value:e.$defaultModelFormat}),Object.defineProperty(moment,"$parseFormat",{value:e.$parseFormat}),Object.defineProperty(moment,"$$pickerTemplates",{value:angular.copy(e.$$pickerTemplates)})}catch(t){angular.extend(moment,e)}return moment}}),angular.module("moment").filter("momentFormat",["$moment",function(t){return function(e,n){var a,o,i,r=t.$defaultViewFormat;return angular.isDefined(e)?(angular.isString(n)?r=n:angular.isArray(n)&&(i=n[0],r=n[1]||r,o=n[2]),a=t(e,i,o),a.isValid()?a.format(r):!angular.isDefined(i)&&(a=t(e,t.$defaultModelFormat,t.strictModel),a.isValid())?a.format(r):e):e}}]),angular.module("moment").directive("input",["$moment","$timeout","indexOf",function(t,e,n){var a=["millisecond","second","minute","hour","day","month","year"],o=t.$strictView,i=t.$strictModel;return{priority:10,restrict:"E",require:"?ngModel",compile:function(r,m){return"date"!==m.type&&"moment"!==m.type?angular.noop:function(r,m,l,d){if(d){var u,s,f,c=t.$defaultViewFormat,p=t.$defaultModelFormat,$=!1,h={min:{attr:null,view:null,model:null},max:{attr:null,view:null,model:null}},v=function(e){m.attr("placeholder",t.$parseFormat(e))},w=function(){var t=!d.$isEmpty(d.$modelValue),e=!d.$isEmpty(d.$viewValue);t?y():e&&g()},g=function(){d.$isEmpty(d.$viewValue)||d.$setViewValue(d.$viewValue)},y=function(){var t=d.$modelValue;d.$isEmpty(t)||e(function(){r.$apply(function(){r[l.ngModel]=t+" "}),r.$apply(function(){r[l.ngModel]=t})},0,!1)},M=function(e){h[e].attr&&h[e].attr.isValid()?(h[e].view=t(h[e].attr.format(c),c),h[e].model=t(h[e].attr.format(p),p)):h[e].attr=h[e].view=h[e].model=null},x=function(e,n){var a,r,m,s,f,$;return"view"==e?(s=c,f=p,$=o):(s=p,f=c,$=i),a=t(n,s,$),r=a.isValid(),m=d.$isEmpty(n),u=m?t(null):a.clone(),m||r?(d.$setValidity("date",!0),l.min&&(!m&&r&&h.min.attr&&a.isBefore(h.min[e])?d.$setValidity("min",!1):d.$setValidity("min",!0)),l.max&&(!m&&r&&h.max.attr&&a.isAfter(h.max[e])?d.$setValidity("max",!1):d.$setValidity("max",!0)),d.$error.min||d.$error.max?void 0:m?n:a.format(f)):(d.$setValidity("date",!1),l.min&&d.$setValidity("min",!0),void(l.max&&d.$setValidity("max",!0)))};if(d.$parsers.push(angular.bind(void 0,x,"view")),d.$formatters.push(angular.bind(void 0,x,"model")),!l.format||l.viewFormat&&l.modelFormat||(c=r.$eval(l.format)||c,p=r.$eval(l.format)||p,r.$watch(l.format,function(t){c=t,p=t,v(t),M("min"),M("max"),g()})),l.viewFormat&&(c=r.$eval(l.viewFormat)||c,r.$watch(l.viewFormat,function(e){e=e||t.$defaultViewFormat,e!==c&&(c=e,v(e),M("min"),M("max"),y())})),l.modelFormat&&(p=r.$eval(l.modelFormat)||p,r.$watch(l.modelFormat,function(e){e=e||t.$defaultModelFormat,e!==p&&(p=e,M("min"),M("max"),g())})),v(c),l.min){var F=function(e){var n;n=angular.isArray(e)&&2==e.length?t(e[0],e[1]):e&&angular.isString(e)?"today"==e?t():t(e,t.$defaultModelFormat):null,(!n^!h.min.attr||n&&h.min.attr&&n.format("X")!==h.min.attr.format("X"))&&(h.min.attr=n,M("min"),w())};F(r.$eval(l.min)),r.$watch(l.min,F,!0)}if(l.max){var V=function(e){var n;n=angular.isArray(e)&&2==e.length?t(e[0],e[1]):e&&angular.isString(e)?"today"==e?t():t(e,t.$defaultModelFormat):null,(!n^!h.max.attr||n&&h.max.attr&&n.format("X")!==h.max.attr.format("X"))&&(h.max.attr=n,M("max"),w())};V(r.$eval(l.max)),r.$watch(l.max,V,!0)}s="day",f=1,l.step&&r.$watch(l.step,function(t){if(t&&angular.isString(t)){var e=t.match(/(\d+)\s(\w+)/);e?(s=e[2],f=parseInt(e[1],10)):(s="day",f=1)}});var k=function(e,o){if(!e.type&&o&&o.type&&(angular.extend(e,o),$=!0),$&&("keydown"!=e.type||/38|40/.test(e.which))){e.preventDefault();var i,m,l,p,v,w=d.$isEmpty(d.$viewValue),g=w?t():t(u.format(c),c,!0);g.isValid()&&("keydown"==e.type?m=/38/.test(e.which):(i=e.originalEvent?e.originalEvent.wheelDelta:e.wheelDelta,m=i/120>0),l=e.shiftKey?a[n(a,s.replace(/s$/,""))+1]||s:s,w&&h.min.attr?p=h.min.view.clone():m?w&&!h.min.attr?p=g.max(h.max.attr?h.max.view:void 0):h.min.attr&&g.isBefore(h.min.view)?p=h.min.view.clone():h.max.attr&&!g.isAfter(h.max.view)?p=g.add(l,f).max(h.max.view):h.max.attr||(p=g.add(l,f)):w&&!h.max.attr?p=g.min(h.min.attr?h.min.view:void 0):h.max.attr&&g.isAfter(h.max.view)?p=h.max.view.clone():h.min.attr&&!g.isBefore(h.min.view)?p=g.subtract(l,f).min(h.min.view):h.min.attr||(p=g.subtract(l,f)),v=(p||g).format(c),r.$apply(function(){d.$setViewValue(v),d.$render()}))}};m.on("mousewheel keydown",k),m.on("focus",function(){$=!0}),m.on("blur",function(){$=!1})}}}}}]),angular.module("moment").directive("momentPicker",["$moment","$log","indexOf",function(t,e){var n=t().startOf("week").format("d"),a=(t().endOf("week").format("d"),function(e){return t.$$pickerTemplates[e||"default"]});return{restrict:"A",templateUrl:function(t,n){var o=a(n.template);return o?o.url:void e.error("Error: [momentDatepicker] Picker template '"+n.template+"' is undefined. Templates must be defined with '$momentProvider.definePickerTemplate'.")},scope:{dateModel:"=momentPicker",format:"=?",modelFormat:"=?",min:"=?",max:"=?",ngShow:"=?"},link:function(e,o,i){function r(){e.today=t(),e.lastMonthMoments=[],e.thisMonthMoments=[],e.nextMonthMoments=[],e.monthsThisYearMoments=[];for(var a=e.displayMoment.clone().startOf("month"),o=a.clone(),i=e.displayMoment.clone().endOf("month"),r=e.displayMoment.format("M"),m=e.displayMoment.format("YYYY");a.format("d")!==n;)e.lastMonthMoments.unshift(a.subtract(1,"day").clone());for(;o.format("M")===r;)e.thisMonthMoments.push(o.clone()),o.add(1,"day");for(;e.lastMonthMoments.length+e.thisMonthMoments.length+e.nextMonthMoments.length<42;)e.nextMonthMoments.push(i.add(1,"day").clone());for(;e.monthsThisYearMoments.length<12;)e.monthsThisYearMoments.push(moment({year:m,month:e.monthsThisYearMoments.length}))}var m=a(i.template).unit,l=t.$defaultModelFormat,d={};e.hasNgShowAttr=!!i.ngShow,i.ngShow||(e.ngShow=!0),e.displayMoment=t(),e.weekMoments=[];for(var u=7;u--;)e.weekMoments.unshift(t().startOf("week").add(u,"day"));var s=function(n){angular.equals(l,n)||(l=n||t.$defaultModelFormat,c(e.dateModel))};i.format&&!i.modelFormat?(l=e.format||t.$defaultModelFormat,e.$watch("format",s)):i.modelFormat&&(l=e.modelFormat||t.$defaultModelFormat,e.$watch("modelFormat",s));var f=function(e,n){var a;a=angular.isArray(n)&&2==n.length?t(n[0],n[1],!0):n&&angular.isString(n)?"today"==n?t():t(n,t.$defaultModelFormat):t(null),d[e]=a.isValid()?a:null};i.min&&e.$watch("min",function(t){f("min",t)},!0),i.max&&e.$watch("max",function(t){f("max",t)},!0),e.getClasses=function(t,n){var a=/6|7/.test(t.isoWeekday()),o=!a,i={weekend:a,weekday:o};return i[t.format("MMM ddd").toLowerCase()]=!0,n?(angular.forEach(n.split(" "),function(n){var a=n.split("-")[0],o=n.split("-")[1]||m;"picked"==a?i[n]=t.isSame(e.dateMoment,m):"current"==a?i[n+" current"]=t.isSame(e.today,o):"invalid"==a&&(d.min||d.max)&&(d.min&&t.isBefore(d.min,o)?i[n+" invalid"]=!0:d.max&&t.isAfter(d.max,o)&&(i[n+" invalid"]=!0))}),i):i},e.setDateTo=function(t){d.min&&t.isBefore(d.min,m)||d.max&&t.isAfter(d.max,m)||(d.min&&(t=t.min(d.min)),d.max&&(t=t.max(d.max)),e.dateModel=t.format(l),e.hasNgShowAttr&&(e.ngShow=!1))};var c=function(n){var a=t(n,l,t.$strictModel);n&&a.isValid()?(e.dateMoment=a.clone(),e.displayMoment=a.clone()):(e.dateMoment=t(""),e.displayMoment=t())};e.$watch("dateModel",c),e.$watch(function(){return e.displayMoment.format("M/YYYY")},function(){r()})}}}]).directive("picker",["$moment","$compile","getOffset",function(t,e,n){var a='style="position:absolute" class="input-picker"',o="format modelFormat min max".split(" "),i=function(t){return t.replace(/[a-z][A-Z]/g,function(t){return t[0]+"-"+t[1]}).toLowerCase()};return{restrict:"A",require:"?ngModel",link:function(t,r,m,l){if(l&&"moment"===m.type){var d=[a];m.picker&&d.push("template="+m.picker),angular.forEach(o,function(t){m[t]&&d.push(i(t)+'="'+m[t]+'"')}),t.$momentPicker||(t.$momentPicker={}),t.$momentPicker[m.ngModel]=!1,d.push("ng-show=\"$momentPicker['"+m.ngModel+"']\"");var u=e('<div moment-picker="'+m.ngModel+'" '+d.join(" ")+"></div>")(t);angular.element(document.body).append(u),u.on("mousedown",function(t){t.preventDefault()}),r.on("focus click",function(){var e=n(r[0]);u.css({left:e.left+"px",top:e.bottom+"px"}),t.$apply(function(t){t.$momentPicker[m.ngModel]=!0})}),r.on("blur keydown",function(e){("keydown"!=e.type||27===e.which)&&t.$apply(function(t){t.$momentPicker[m.ngModel]=!1})}),t.$on("$destroy",function(){u.off().remove()})}}}}]);